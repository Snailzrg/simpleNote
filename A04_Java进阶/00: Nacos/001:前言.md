[toc]

# 一：Spring Cloud - Nacos与Eureka区别及如何选型

Nacos与Eureka均提供注册中心和服务治理功能，以下为两者差异和选型方案。

### 1:功能差异

|   模块   | Nacos | Eureka |                             说明                             |
| :------: | :---: | :----: | :----------------------------------------------------------: |
| 注册中心 |  是   |   是   |             服务治理基本功能，负责服务中心化注册             |
| 配置中心 |  是   |  `否`  |      Eureka需要配合Config实现配置中心，且不提供管理界面      |
| 动态刷新 |  是   |  `否`  | Eureka需要配合MQ实现配置动态刷新，Nacos采用Netty保持TCP长连接实时推送 |
| 可用区AZ |  是   |   是   |   对服务集群划分不同区域，实现区域隔离，并提供容灾自动切换   |
|   分组   |  是   |  `否`  |             Nacos可用根据业务和环境进行分组管理              |
|  元数据  |  是   |   是   |             提供服务标签数据，例如环境或服务标识             |
|   权重   |  是   |  `否`  |         Nacos默认提供权重设置功能，调整承载流量压力          |
| 健康检查 |  是   |   是   | Nacos支持由客户端或服务端发起的健康检查，Eureka是由客户端发起心跳 |
| 负载均衡 |  是   |   是   |             均提供负责均衡策略，Eureka采用Ribion             |
| 管理界面 |  是   |  `否`  |       Nacos支持对服务在线管理，Eureka只是预览服务状态        |

### 2:部署安装

|   模块   |  Nacos   |         Eureka          |                  说明                  |
| :------: | :------: | :---------------------: | :------------------------------------: |
|  MySql   |    是    |          `否`           |  Nacos需要采用MySql进行数据进行持久化  |
|    MQ    |   `否`   |           是            |    Eureka需要采用MQ进行配置中心刷新    |
| 配置中心 |    是    |          `否`           | Eureka结合Config或者Consul实现配置中心 |
| 配置文件 | 在线编辑 | 本地文件或者Git远程文件 |       Eureka结合Config或者Consul       |
|   集群   |    是    |           是            |       Nacos需要配置集群ip再启动        |

### 3:稳定及扩展性

|   模块   |  Nacos   | Eureka  |                             说明                             |
| :------: | :------: | :-----: | :----------------------------------------------------------: |
|   版本   |  1.0.0   |  1.9.9  |           Eureka2.0已停止开发,Nacos处于1.x-2.0开发           |
|   厂商   | 阿里巴巴 | Netflix |               Netflix已长期用于生产,阿里刚起步               |
| 生产建议 |   `否`   |   是    | Nacos0.8以前不可用于生产,建议生产采用Nacos1.0,便于节省配置中心集群和服务管理 |
| 未来发展 |    是    |  `否`   | Nacos 2.0主要关注在统一服务管理、服务共享及服务治理体系的开放的服务平台的建设 |

### 4:选型建议

采用Eureka方案的考虑

- 想用Spring Cloud原生全家桶
- 想用本地文件和Git作为配置管理的,将配置与服务分开管理
- 考虑短期的稳定性

采用Nacos方案的考虑

- 想在线对服务进行上下线和流量管理
- 不想采用MQ实现配置中心动态刷新
- 不想新增配置中心生产集群
- 考虑引入Spring Cloud Alibaba生态

相关文章

- [Spring Cloud - Nacos集群配置和集成](https://perkins4j2.github.io/posts/57096/)
- [Spring Cloud - Ribbon在Zuul上实现灰度和版本测试](https://perkins4j2.github.io/posts/25628/)
- [Spring Cloud - 如何利用Zuul实现接口限流](https://perkins4j2.github.io/posts/33184/)
- [Spring Cloud - 如何利用Zuul进行网关开发](https://perkins4j2.github.io/posts/33205/)



# 二：nacos安装配置

[官网](https://nacos.io/zh-cn/docs/quick-start.html)

## 1: Nacos 地图

一图看懂 Nacos

![nacos_map](https://gitee.com/snailzrg/snail_img/raw/master/picgo_snail_img/nacosMap.jpg)

![nacos_landscape.png](https://gitee.com/snailzrg/snail_img/raw/master/picgo_snail_img/1533045871534-e64b8031-008c-4dfc-b6e8-12a597a003fb.png)



## 2：下载启动

```
下载nacos最新版
wget https://github.com/alibaba/nacos/releases/download/1.3.2/nacos-server-1.3.2.tar.gz

解压文件
tar -xvf  nacos-server-1.3.2.tar.gz

cd nacos/conf
vim nacos-mysql.sql
运行nacos配置mysql脚本
```

启动命令(standalone代表着单机模式运行，非集群模式):

```
sh startup.sh -m standalone
```

### 2.1：nacos 启动报错

1: Failed to obtain JDBC Connection； nested exception......

```
复制maven中mysql驱动jar包到nacos的根目录下新建plugins/mysql文件夹下
改名 将nacos配置文件夹下 application.properties 改成 bootstrap.properties   
```



## 3.  集群配置









## 4.服务注册&发现和配置管理

### 服务注册

```
curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&ip=20.18.7.10&port=8080'
```

### 服务发现

```
curl -X GET 'http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=nacos.naming.serviceName'
```

### 发布配置

```
curl -X POST "http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&group=test&content=HelloWorld"
```

### 获取配置

```
curl -X GET "http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&group=test"
```

​	







