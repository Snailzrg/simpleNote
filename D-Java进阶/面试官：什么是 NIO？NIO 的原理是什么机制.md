## é¢è¯•å®˜ï¼šä»€ä¹ˆæ˜¯ NIOï¼ŸNIO çš„åŸç†æ˜¯ä»€ä¹ˆæœºåˆ¶ï¼Ÿ

ç‚¹å‡»å…³æ³¨ ğŸ‘‰ [JavaåŸºåŸº](javascript:void(0);) *3å¤©å‰*

ç‚¹å‡»ä¸Šæ–¹â€œJavaåŸºåŸºâ€ï¼Œé€‰æ‹©â€œè®¾ä¸ºæ˜Ÿæ ‡â€

åšç§¯æçš„äººï¼Œè€Œä¸æ˜¯ç§¯æåºŸäººï¼

æºç ç²¾å“ä¸“æ 

- [åŸåˆ› | Java 2020 è¶…ç¥ä¹‹è·¯ï¼Œå¾ˆè‚~](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21#wechat_redirect)
- [ä¸­æ–‡è¯¦ç»†æ³¨é‡Šçš„å¼€æºé¡¹ç›®](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486264&idx=1&sn=475ac3f1ef253a33daacf50477203c80&chksm=fa497489cd3efd9f7298f5da6aad0c443ae15f398436aff57cb2b734d6689e62ab43ae7857ac&scene=21#wechat_redirect)
- [RPC æ¡†æ¶ Dubbo æºç è§£æ](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247484647&idx=1&sn=9eb7e47d06faca20d530c70eec3b8d5c&chksm=fa497b56cd3ef2408f807e66e0903a5d16fbed149ef7374021302901d6e0260ad717d903e8d4&scene=21#wechat_redirect)
- [ç½‘ç»œåº”ç”¨æ¡†æ¶ Netty æºç è§£æ](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247485054&idx=2&sn=9f3b85f7b8454634da6c5c2ded9b4dba&chksm=fa4979cfcd3ef0d9d2dd92d8d1bd8f1553abc6e2095a5d743e0b2c2afe4955ea2bbbd7a4b79d&token=55862109&lang=zh_CN&scene=21#wechat_redirect)
- [æ¶ˆæ¯ä¸­é—´ä»¶ RocketMQ æºç è§£æ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486256&idx=1&sn=81daccd3fcd2953456c917630636fb26&chksm=fa497481cd3efd97d9239f5eab060e49dea9876a6046eadba0effb878d2fb51f3ba5733e4c0b&scene=21#wechat_redirect)
- [æ•°æ®åº“ä¸­é—´ä»¶ Sharding-JDBC å’Œ MyCAT æºç è§£æ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486257&idx=1&sn=4d3c9c675f8833157641a2e0b48e498c&chksm=fa497480cd3efd96fe17975b0b8b141e87fd0a62673e6a30b501460de80b3eb997056f09de08&scene=21#wechat_redirect)
- [ä½œä¸šè°ƒåº¦ä¸­é—´ä»¶ Elastic-Job æºç è§£æ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486258&idx=1&sn=ae5665ae9c3002b53f87cab44948a096&chksm=fa497483cd3efd950514da5a37160e7fd07f0a96f39265cf7ba3721985e5aadbdcbe7aafc34a&scene=21#wechat_redirect)
- [åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ TCC-Transaction æºç è§£æ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486259&idx=1&sn=b023cf3dbf97e5da59db2f4ee632f5a6&chksm=fa497482cd3efd9402d71469f71863f71a6998b27e12ca2e00446b8178d79dcef0721d8e570a&scene=21#wechat_redirect)
- [Eureka å’Œ Hystrix æºç è§£æ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486260&idx=1&sn=8f14c0c191d6f8df6eb34202f4ad9708&chksm=fa497485cd3efd93937143a648bc1b530bc7d1f6f8ad4bf2ec112ffe34dee80b474605c22db0&scene=21#wechat_redirect)
- [Java å¹¶å‘æºç ](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486261&idx=1&sn=bd69f26aadfc826f6313ffbb95e44ee5&chksm=fa497484cd3efd92352d6fb3d05ccbaebca2fafed6f18edbe5be70c99ba088db5c8a7a8080c1&scene=21#wechat_redirect)

æ¥æºï¼šblog.csdn.net/qq_36520235/

- NIOå’ŒIOåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ
- å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯é€šé“ï¼Œä»€ä¹ˆæ˜¯ç¼“å†²åŒºçš„æ¦‚å¿µ
- NIOçš„åº•å±‚å·¥ä½œåŸç†
- NIO å·¥ä½œä»£ç ç¤ºä¾‹
- NIOå’ŒNettyçš„å·¥ä½œæ¨¡å‹å¯¹æ¯”ï¼Ÿ

------

# NIOå’ŒIOåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

é¦–å…ˆè¯´ä¸€ä¸‹æ ¸å¿ƒåŒºåˆ«ï¼š

1. NIOæ˜¯ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œä½†æ˜¯IOæ˜¯ä»¥æœ€åŸºç¡€çš„å­—èŠ‚æµçš„å½¢å¼å»å†™å…¥å’Œè¯»å‡ºçš„ã€‚æ‰€ä»¥åœ¨æ•ˆç‡ä¸Šçš„è¯ï¼Œè‚¯å®šæ˜¯NIOæ•ˆç‡æ¯”IOæ•ˆç‡ä¼šé«˜å‡ºå¾ˆå¤šã€‚
2. NIOä¸åœ¨æ˜¯å’ŒIOä¸€æ ·ç”¨OutputStreamå’ŒInputStream è¾“å…¥æµçš„å½¢å¼æ¥è¿›è¡Œå¤„ç†æ•°æ®çš„ï¼Œä½†æ˜¯åˆæ˜¯åŸºäºè¿™ç§æµçš„å½¢å¼ï¼Œè€Œæ˜¯é‡‡ç”¨äº†é€šé“å’Œç¼“å†²åŒºçš„å½¢å¼æ¥è¿›è¡Œå¤„ç†æ•°æ®çš„ã€‚
3. è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯NIOçš„é€šé“æ˜¯å¯ä»¥åŒå‘çš„ï¼Œä½†æ˜¯IOä¸­çš„æµåªèƒ½æ˜¯å•å‘çš„ã€‚
4. è¿˜æœ‰å°±æ˜¯NIOçš„ç¼“å†²åŒºï¼ˆå…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼‰è¿˜å¯ä»¥è¿›è¡Œåˆ†ç‰‡ï¼Œå¯ä»¥å»ºç«‹åªè¯»ç¼“å†²åŒºã€ç›´æ¥ç¼“å†²åŒºå’Œé—´æ¥ç¼“å†²åŒºï¼Œåªè¯»ç¼“å†²åŒºå¾ˆæ˜æ˜¾å°±æ˜¯å­—é¢æ„æ€ï¼Œç›´æ¥ç¼“å†²åŒºæ˜¯ä¸ºåŠ å¿« I/O é€Ÿåº¦ï¼Œè€Œä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼åˆ†é…å…¶å†…å­˜çš„ç¼“å†²åŒºã€‚
5. è¡¥å……ä¸€ç‚¹ï¼šNIOæ¯”ä¼ ç»Ÿçš„BIOæ ¸å¿ƒåŒºåˆ«å°±æ˜¯ï¼ŒNIOé‡‡ç”¨çš„æ˜¯å¤šè·¯å¤ç”¨çš„IOæ¨¡å‹ï¼Œæ™®é€šçš„IOç”¨çš„æ˜¯é˜»å¡çš„IOæ¨¡å‹ï¼Œä¸¤ä¸ªä¹‹é—´çš„æ•ˆç‡è‚¯å®šæ˜¯å¤šè·¯å¤ç”¨æ•ˆç‡æ›´é«˜

# å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯é€šé“ï¼Œä»€ä¹ˆæ˜¯ç¼“å†²åŒºçš„æ¦‚å¿µ

## é€šé“æ˜¯ä¸ªä»€ä¹ˆæ„æ€ï¼Ÿ

- é€šé“æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿã€‚åˆ°ä»»ä½•ç›®çš„åœ°(æˆ–æ¥è‡ªä»»ä½•åœ°æ–¹)çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é€šè¿‡ä¸€ä¸ª Channel å¯¹è±¡ï¼ˆé€šé“ï¼‰ã€‚ä¸€ä¸ª Buffer å®è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ã€‚å‘é€ç»™ä¸€ä¸ªé€šé“çš„æ‰€æœ‰å¯¹è±¡éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼›åŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦è¯»åˆ°ç¼“å†²åŒºä¸­ã€‚Channelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚æ‹¿ NIO ä¸åŸæ¥çš„ I/O åšä¸ªæ¯”è¾ƒï¼Œé€šé“å°±åƒæ˜¯æµã€‚
- æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ Buffer å¯¹è±¡æ¥å¤„ç†ã€‚æ‚¨æ°¸è¿œä¸ä¼šå°†å­—èŠ‚ç›´æ¥å†™å…¥é€šé“ä¸­ï¼Œç›¸åï¼Œæ‚¨æ˜¯å°†æ•°æ®å†™å…¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—èŠ‚çš„ç¼“å†²åŒºã€‚åŒæ ·ï¼Œæ‚¨ä¸ä¼šç›´æ¥ä»é€šé“ä¸­è¯»å–å­—èŠ‚ï¼Œè€Œæ˜¯å°†æ•°æ®ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œå†ä»ç¼“å†²åŒºè·å–è¿™ä¸ªå­—èŠ‚ã€‚

## ç¼“å†²åŒºæ˜¯ä»€ä¹ˆæ„æ€ï¼š

- Buffer æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ å®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…åˆšè¯»å‡ºçš„æ•°æ®ã€‚åœ¨ NIO ä¸­åŠ å…¥ Buffer å¯¹è±¡ï¼Œä½“ç°äº†æ–°åº“ä¸åŸ I/O çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚åœ¨é¢å‘æµçš„ I/O ä¸­ï¼Œæ‚¨å°†æ•°æ®ç›´æ¥å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ° Stream å¯¹è±¡ä¸­
- åœ¨ NIO åº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒæ˜¯å†™å…¥åˆ°ç¼“å†²åŒºä¸­çš„ã€‚ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œæ‚¨éƒ½æ˜¯å°†å®ƒæ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚
- ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚é€šå¸¸å®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç§ç±»çš„æ•°ç»„ã€‚ä½†æ˜¯ä¸€ä¸ªç¼“å†²åŒºä¸ ä»…ä»… æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹

## ç¼“å†²åŒºçš„ç±»å‹ï¼š

> ByteBuffer
>
> CharBuffer
>
> ShortBuffer
>
> IntBuffer
>
> LongBuffer
>
> FloatBuffer
>
> DoubleBuffer

# NIOçš„åº•å±‚å·¥ä½œåŸç†

## å…ˆæ¥äº†è§£ä¸€ä¸‹bufferçš„å·¥ä½œæœºåˆ¶ï¼š

- capacity ç¼“å†²åŒºæ•°ç»„çš„æ€»é•¿åº¦
- position ä¸‹ä¸€ä¸ªè¦æ“ä½œçš„æ•°æ®å…ƒç´ çš„ä½ç½®
- limit ç¼“å†²åŒºæ•°ç»„ä¸­ä¸å¯æ“ä½œçš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œlimit<=capacity
- mark ç”¨äºè®°å½•å½“å‰ position çš„å‰ä¸€ä¸ªä½ç½®æˆ–è€…é»˜è®¤æ˜¯ 0

1.è¿™ä¸€æ­¥å…¶å®æ˜¯å½“æˆ‘ä»¬åˆšå¼€å§‹åˆå§‹åŒ–è¿™ä¸ªbufferæ•°ç»„çš„æ—¶å€™ï¼Œå¼€å§‹é»˜è®¤æ˜¯è¿™æ ·çš„

2ã€ä½†æ˜¯å½“ä½ å¾€bufferæ•°ç»„ä¸­å¼€å§‹å†™å…¥çš„æ—¶å€™å‡ ä¸ªå­—èŠ‚çš„æ—¶å€™å°±ä¼šå˜æˆä¸‹é¢çš„å›¾ï¼Œpositionä¼šç§»åŠ¨ä½ æ•°æ®çš„ç»“æŸçš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦æŠŠbufferä¸­çš„æ•°æ®å†™åˆ°channelç®¡é“ä¸­ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨è¿™ä¸ª`buffer.flip();`æ–¹æ³•ï¼Œ

3ã€å½“ä½ è°ƒç”¨å®Œ2ä¸­çš„æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå˜æˆä¸‹é¢çš„å›¾äº†ï¼Œè¿™æ ·çš„è¯å…¶å®å°±å¯ä»¥çŸ¥é“ä½ åˆšåˆšå†™åˆ°bufferä¸­çš„æ•°æ®æ˜¯åœ¨position---->limitä¹‹é—´ï¼Œç„¶åä¸‹ä¸€æ­¥è°ƒç”¨`clearï¼ˆï¼‰ï¼›`

4ã€è¿™æ—¶åº•å±‚æ“ä½œç³»ç»Ÿå°±å¯ä»¥ä»ç¼“å†²åŒºä¸­æ­£ç¡®è¯»å–è¿™ 5 ä¸ªå­—èŠ‚æ•°æ®å‘é€å‡ºå»äº†ã€‚åœ¨ä¸‹ä¸€æ¬¡å†™æ•°æ®ä¹‹å‰æˆ‘ä»¬åœ¨è°ƒä¸€ä¸‹ clear() æ–¹æ³•ã€‚ç¼“å†²åŒºçš„ç´¢å¼•çŠ¶æ€åˆå›åˆ°åˆå§‹ä½ç½®ã€‚ï¼ˆå…¶å®è¿™ä¸€æ­¥æœ‰ç‚¹åƒIOä¸­çš„æŠŠè½¬è¿å­—èŠ‚æ•°ç»„ `char[] buf = new char[1024];` ä¸è¶³1024å­—èŠ‚çš„éƒ¨åˆ†ç»™å¼ºåˆ¶åˆ·æ–°å‡ºå»çš„æ„æ€ï¼‰

## è¡¥å……ï¼š

1ã€è¿™é‡Œè¿˜è¦è¯´æ˜ä¸€ä¸‹ markï¼Œå½“æˆ‘ä»¬è°ƒç”¨ `mark()` æ—¶ï¼Œå®ƒå°†è®°å½•å½“å‰ position çš„å‰ä¸€ä¸ªä½ç½®ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ reset æ—¶ï¼Œposition å°†æ¢å¤ mark è®°å½•ä¸‹æ¥çš„å€¼

2.clear()æ–¹æ³•ä¼šï¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚positionå°†è¢«è®¾å›0ï¼Œlimitè¢«è®¾ç½®æˆ capacityçš„å€¼ï¼ˆè¿™ä¸ªä¸ªäººçš„ç†è§£å°±æ˜¯å½“ä½ åœ¨flipï¼ˆï¼‰æ–¹æ³•çš„åŸºç¡€ä¸Šå·²ç»è®°ä½ä½ å†™å…¥äº†å¤šå°‘å­—èŠ‚æ•°æ®ï¼Œç›´æ¥æŠŠpositionåˆ°limitä¹‹é—´çš„ä¹Ÿå°±æ˜¯ä½ å†™å…¥å·²ç»è®°ä½çš„æ•°æ®ç»™â€œå¤åˆ¶â€åˆ°ç®¡é“ä¸­ï¼‰

3.å½“ä½ æŠŠç¼“å†²åŒºçš„æ•°å±€å†™å…¥åˆ°ç®¡é“ä¸­çš„æ—¶å€™ï¼Œä½ éœ€è¦è°ƒç”¨flip()æ–¹æ³•å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œè°ƒç”¨flip()æ–¹æ³•ä¼šå°†positionè®¾å›0ï¼Œå¹¶å°†limitè®¾ç½®æˆä¹‹å‰positionçš„å€¼ã€‚buf.flip();ï¼ˆå…¶å®æˆ‘ä¸ªäººç†è§£çš„å°±ç›¸å½“äºå…ˆè®°ä½ç¼“å†²åŒºç¼“å†²äº†å¤šå°‘æ•°æ®ï¼‰

# NIO å·¥ä½œä»£ç ç¤ºä¾‹

```
public void selector() throws IOException {
//å…ˆç»™ç¼“å†²åŒºç”³è¯·å†…å­˜ç©ºé—´
        ByteBuffer buffer = ByteBuffer.allocate(1024);
     //æ‰“å¼€Selectorä¸ºäº†å®ƒå¯ä»¥è½®è¯¢æ¯ä¸ª Channel çš„çŠ¶æ€
        Selector selector = Selector.open();
        ServerSocketChannel ssc = ServerSocketChannel.open();
        ssc.configureBlocking(false);//è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼
        ssc.socket().bind(new InetSocketAddress(8080));
        ssc.register(selector, SelectionKey.OP_ACCEPT);//æ³¨å†Œç›‘å¬çš„äº‹ä»¶
        while (true) {
            Set selectedKeys = selector.selectedKeys();//å–å¾—æ‰€æœ‰keyé›†åˆ
            Iterator it = selectedKeys.iterator();
            while (it.hasNext()) {
                SelectionKey key = (SelectionKey) it.next();
                if ((key.readyOps() & SelectionKey.OP_ACCEPT) == SelectionKey.OP_ACCEPT) {
                    ServerSocketChannel ssChannel = (ServerSocketChannel) key.channel();
                 SocketChannel sc = ssChannel.accept();//æ¥å—åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚
                    sc.configureBlocking(false);
                    sc.register(selector, SelectionKey.OP_READ);
                    it.remove();
                } else if
                ((key.readyOps() & SelectionKey.OP_READ) == SelectionKey.OP_READ) {
                    SocketChannel sc = (SocketChannel) key.channel();
                    while (true) {
                        buffer.clear();
                        int n = sc.read(buffer);//è¯»å–æ•°æ®
                        if (n <= 0) {
                            break;
                        }
                        buffer.flip();
                    }
                    it.remove();
                }
            }
        }
}
```

## æœ€åç»™å¤§å®¶çœ‹ä¸€ä¸‹æ•´ä½“çš„NIOçš„ç¤ºæ„å›¾

# NIOå’ŒNettyçš„å·¥ä½œæ¨¡å‹å¯¹æ¯”ï¼Ÿ

## ï¼ˆ1ï¼‰NIOçš„å·¥ä½œæµç¨‹æ­¥éª¤ï¼š

1. é¦–å…ˆæ˜¯å…ˆåˆ›å»ºServerSocketChannel å¯¹è±¡ï¼Œå’ŒçœŸæ­£å¤„ç†ä¸šåŠ¡çš„çº¿ç¨‹æ± 
2. ç„¶åç»™åˆšåˆšåˆ›å»ºçš„ServerSocketChannel å¯¹è±¡è¿›è¡Œç»‘å®šä¸€ä¸ªå¯¹åº”çš„ç«¯å£ï¼Œç„¶åè®¾ç½®ä¸ºéé˜»å¡
3. ç„¶ååˆ›å»ºSelectorå¯¹è±¡å¹¶æ‰“å¼€ï¼Œç„¶åæŠŠè¿™Selectorå¯¹è±¡æ³¨å†Œåˆ°ServerSocketChannel ä¸­ï¼Œå¹¶è®¾ç½®å¥½ç›‘å¬çš„äº‹ä»¶ï¼Œç›‘å¬ SelectionKey.OP_ACCEPT
4. æ¥ç€å°±æ˜¯Selectorå¯¹è±¡è¿›è¡Œæ­»å¾ªç¯ç›‘å¬æ¯ä¸€ä¸ªChannelé€šé“çš„äº‹ä»¶ï¼Œå¾ªç¯æ‰§è¡Œ Selector.select() æ–¹æ³•ï¼Œè½®è¯¢å°±ç»ªçš„ Channel
5. ä»Selectorä¸­è·å–æ‰€æœ‰çš„SelectorKeyï¼ˆè¿™ä¸ªå°±å¯ä»¥çœ‹æˆæ˜¯ä¸åŒçš„äº‹ä»¶ï¼‰ï¼Œå¦‚æœSelectorKeyæ˜¯å¤„äº OP_ACCEPT çŠ¶æ€ï¼Œè¯´æ˜æ˜¯æ–°çš„å®¢æˆ·ç«¯æ¥å…¥ï¼Œè°ƒç”¨ ServerSocketChannel.accept æ¥æ”¶æ–°çš„å®¢æˆ·ç«¯ã€‚
6. ç„¶åå¯¹è¿™ä¸ªæŠŠè¿™ä¸ªæ¥å—çš„æ–°å®¢æˆ·ç«¯çš„Channelé€šé“æ³¨å†Œåˆ°ServerSocketChannelä¸Šï¼Œå¹¶ä¸”æŠŠä¹‹å‰çš„OP_ACCEPT çŠ¶æ€æ”¹ä¸ºSelectionKey.OP_READè¯»å–äº‹ä»¶çŠ¶æ€ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºéé˜»å¡çš„ï¼Œç„¶åæŠŠå½“å‰çš„è¿™ä¸ªSelectorKeyç»™ç§»é™¤æ‰ï¼Œè¯´æ˜è¿™ä¸ªäº‹ä»¶å®Œæˆäº†
7. å¦‚æœç¬¬5æ­¥çš„æ—¶å€™è¿‡æ¥çš„äº‹ä»¶ä¸æ˜¯OP_ACCEPT çŠ¶æ€ï¼Œé‚£å°±æ˜¯OP_READè¯»å–æ•°æ®çš„äº‹ä»¶çŠ¶æ€ï¼Œç„¶åè°ƒç”¨æœ¬æ–‡ç« çš„ä¸Šé¢çš„é‚£ä¸ªè¯»å–æ•°æ®çš„æœºåˆ¶å°±å¯ä»¥äº†

## ï¼ˆ2ï¼‰Nettyçš„å·¥ä½œæµç¨‹æ­¥éª¤ï¼š

1. åˆ›å»º NIO çº¿ç¨‹ç»„ EventLoopGroup å’Œ ServerBootstrapã€‚
2. è®¾ç½® ServerBootstrap çš„å±æ€§ï¼šçº¿ç¨‹ç»„ã€SO_BACKLOG é€‰é¡¹ï¼Œè®¾ç½® NioServerSocketChannel ä¸º Channelï¼Œè®¾ç½®ä¸šåŠ¡å¤„ç† Handler
3. ç»‘å®šç«¯å£ï¼Œå¯åŠ¨æœåŠ¡å™¨ç¨‹åºã€‚
4. åœ¨ä¸šåŠ¡å¤„ç† TimeServerHandler ä¸­ï¼Œè¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶ç»™å‡ºå“åº”

## ï¼ˆ3ï¼‰ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼š

1. OP_ACCEPT çš„å¤„ç†è¢«ç®€åŒ–ï¼Œå› ä¸ºå¯¹äº accept æ“ä½œçš„å¤„ç†åœ¨ä¸åŒä¸šåŠ¡ä¸Šéƒ½æ˜¯ä¸€è‡´çš„ã€‚
2. åœ¨ NIO ä¸­éœ€è¦è‡ªå·±æ„å»º ByteBuffer ä» Channel ä¸­è¯»å–æ•°æ®ï¼Œè€Œ Netty ä¸­æ•°æ®æ˜¯ç›´æ¥è¯»å–å®Œæˆå­˜æ”¾åœ¨ ByteBuf ä¸­çš„ã€‚ç›¸å½“äºçœç•¥äº†ç”¨æˆ·è¿›ç¨‹ä»å†…æ ¸ä¸­å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚
3. åœ¨ Netty ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä½¿ç”¨ä¸€ä¸ªè§£ç å™¨ FixedLengthFrameDecoderï¼Œå¯ä»¥ç”¨äºå¤„ç†å®šé•¿æ¶ˆæ¯çš„é—®é¢˜ï¼Œèƒ½å¤Ÿè§£å†³ TCP ç²˜åŒ…è¯»åŠåŒ…é—®é¢˜ï¼Œååˆ†æ–¹ä¾¿ã€‚